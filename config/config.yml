symbol: "BTCUSDT"
timeframe: "1h"

mode: "paper" # 可选: "dry-run", "paper", "live-testnet", "live-mainnet"
equity_base: 1000

exchange:
  name: "binance"
  base_url: "https://api.binance.com"
  ws_url: "wss://stream.binance.com:9443/ws"
  api_key: "${BINANCE_API_KEY}"
  api_secret: "${BINANCE_API_SECRET}"
  allow_live: false # 安全保险丝，未显式允许则 live 阻断
  symbols_allowlist: ["BTCUSDT"] # 允许交易的品种
  min_notional: 5 # 美元最小名义，示例值，实际应从 exchangeInfo 获取
  min_qty: 0.001 # 最小数量，示例值
  qty_step: 0.0001 # 数量步进
  price_step: 0.01 # 价格步进

risk:
  max_position_pct: 0.3
  max_daily_loss_pct: 1
# === 修改点 1: 策略基础配置 ===
strategy:
  type: "trend_filtered" # ★ 必须与你 V2.3 代码中的注册名一致
  # 默认参数（用于实盘或非 sweep 模式）
  short_window: 10
  long_window: 60
  slope_threshold: 0.1 # ★ V2.3 新参数
  atr_period: 14 # ★ V2.3 新参数
  atr_stop_multiplier: 2.0 # ★ V2.3 止损倍数

backtest:
  data_dir: "data/history"
  symbol: "BTCUSDT"
  interval: "1h"
  # 为了 Walk-Forward 验证效果，建议覆盖完整周期（牛-熊-震荡）
  start: "2021-01-01T00:00:00Z"
  end: "2024-01-01T00:00:00Z"
  initial_equity: 1000
  auto_download: true
  quiet_risk_logs: true
  flatten_on_end: true

  fees:
    maker: 0.0002
    taker: 0.0004
    slippage_bp: 1.0

  sizing:
    position_pct: 0.2
    trade_notional: 200

  # 回测时的策略覆盖配置
  strategy:
    type: "trend_filtered" # ★ 保持一致

  # === 修改点 2: V2.3 验证核心配置 ===
  sweep:
    enabled: true
    mode: "grid"
    min_trades: 15 # ★ 提高门槛，带有过滤器的策略如果不交易就没法验证
    max_drawdown: 0.3 # 允许最大 30% 回撤
    min_sharpe: 0.0 # 要求至少不亏钱
    low_trades_penalty: 2.0 # 对交易过少的组合加大惩罚

    # ★ 针对 V2.3 逻辑的参数网格
    params:
      # 寻找最佳趋势定义：长周期均线
      long_window: [60, 90, 120]

      # 核心验证：斜率过滤器多强才合适？
      slope_threshold: [0.05, 0.1, 0.2]

      # (可选) 如果你想验证止损宽松度，可以把下面这行取消注释
      # atr_stop_multiplier: [1.5, 2.0, 3.0]

    objective:
      total_return_weight: 0.3
      sharpe_weight: 0.5 # 侧重夏普（稳定性）
      max_drawdown_weight: 0.2 # 兼顾回撤
